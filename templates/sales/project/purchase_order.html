<!-- Layout eklemimizi sağlayan komut. -->
{% extends "layout.html" %}
<!-- Static dosyalarından yararlanmamız için. -->
{% load static i18n%}

<!-- Her sayfada sayfa özelinde dinamik olarak değişmesi gereken kısımlar burada tanımlanıyor. -->
{% block title %}{% trans 'Purchase Order' %}{% endblock %}
{% block mainDirectory %}{% trans 'Project' %}{% endblock %}
{% block childDirectory %}{% trans 'Purchase Order' %}{% endblock childDirectory %}
{% block href %}{% url 'information:customer_data' %}{% endblock %}
{% block mainRoute %}Purchase Order{% endblock %}

{% block plugins %}
<script src="{% static 'lib/global_assets/js/plugins/tables/datatables/datatables.min.js' %}"></script>
<script src="{% static 'lib/global_assets/js/plugins/forms/selects/select2.min.js' %}"></script>
<script src="{% static 'lib/global_assets/js/plugins/forms/selects/bootstrap_multiselect.js' %}"></script>
{% endblock %}

{% block demo_pages %}
<script src="{% static 'lib/global_assets/js/demo_pages/form_select2.js' %}"></script>
{% endblock %}

{% block right_aside %}
{% include "./right_sidebar.html" %}
{% endblock %}

{% block content %}
<!-- StyleSheet-->
<link rel="stylesheet" href="{% static 'css/information/company/company_add.css' %}">
<!-- /StyleSheet End-->

{% block modals %}
{% include "./purchase_order_modals.html" %}
{% endblock %}

<!-- Content bloğu -->
<div class="card">
 <!--excel and pdf buttons-->
 <ul class="fab-menu fab-menu-top" data-fab-toggle="hover">
    <li>
        <a class="fab-menu-btn btn bg-gray btn-float rounded-round btn-icon">
            <i class="fab-icon-open icon-grid3"></i>
            <i class="fab-icon-close icon-cross2"></i>
        </a>
        <ul class="fab-menu-inner">
            <li>
                <div data-fab-label="Pdf">
                    <a id="pdfButton" class="btn bg-transparent rounded-round btn-icon btn-float button-purchase-order-pdf">
                        <i class="icon-file-pdf"></i>
                    </a>
                </div>
            </li>
            <li>
                <div data-fab-label="Excel">
                    <a id="excelButton" class="btn bg-transparent rounded-round btn-icon btn-float button-purchase-order-excel">
                        <i class="icon-file-excel"></i>
                    </a>
                </div>
            </li>
        </ul>
    </li>
</ul>
<!--excel and pdf buttons-->

    <div class="card-header">
        <div class="media flex-md-row mb-2">
<!--            <a id="iconBuild" href="#" class="align-self-md-start mr-3">-->
<!--                <img src="{% static 'images/icons/building.svg' %}" class="rounded" width="44" height="44" alt="">-->
<!--            </a>-->
            <div class="media-body">
                <div class="wizard-form steps-basic wizard clearfix" role="application">
                    <div class="steps clearfix">
                        <ul role="tablist">
                            <li role="tab" class="done">
                                <a href="{% url 'sales:project_request' project.id %}" class="">
                                    <span class="number">1</span>
                                    {% trans "Request" %}
                                </a>
                            </li>
                            <li role="tab" class="done">
                                <a href="{% url 'sales:project_inquiry' project.id %}" class="">
                                    <span class="number">2</span>
                                    {% trans "Inquiry" %}
                                </a>
                            </li>
                            <li role="tab" class="done">
                                <a href="{% url 'sales:project_quotation' project.id %}" class="">
                                    <span class="number">3</span>
                                    {% trans "Quotation" %}
                                </a>
                            </li>
                            <li role="tab" class="current">
                                <a href="{% url 'sales:project_purchase_order' project.id %}" class="">
                                    <span class="number">4</span>
                                    {% trans "Purchase Order" %}
                                </a>
                            </li>
                            <li role="tab" class="last">
                                <a href="{% url 'sales:project_delivery' project.id %}" class="">
                                    <span class="number">5</span>
                                    {% trans "Delivery" %}
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="header-elements">
            </div>
        </div>
    </div>
    <div class="card-body">
        <ul id="tabHeader" class="nav nav-pills nav-pills-bordered nav-justified">
            {% for quotation_no, value in quotation_based_project_purchase_order_forms.items %}
            <li class="nav-item align-items-center" style="position:relative;">
                <a href="#{{ quotation_no }}" data-toggle="tab"
                   class="nav-link {% if forloop.counter0 == 0 %} active{% endif %}">
                    {{ quotation_no }}
                </a>
            </li>
            {% endfor %}
            <li class="ml-2 add-tab-button">
                <a class="nav-link text-success" type="button" data-toggle="modal"
                   data-target="#modal_purchase_order_add">
                    <i class="icon-new-tab"></i>
                </a>
            </li>
        </ul>
        <div id="tabBody" class="tab-content">
            {% for quotation_no, value in quotation_based_project_purchase_order_forms.items %}
            <div id="{{ quotation_no }}"
                 data-quotation-id="{{ value.id }}" data-touch="false" data-interval="false"
                 class="tab-pane fade show carousel slide{% if forloop.counter0 == 0 %} active{% endif %}">

                <ol class="carousel-indicators" style="position: relative;">
                    {% for project_purchase_order_form in value.forms %}
                    <li data-target="#{{ quotation_no }}" data-slide-to="{{ forloop.counter0 }}"
                        class="{% if forloop.counter0 == 0 %} active{% endif %}"></li>
                    {% endfor %}
                </ol>
                <div class="carousel-inner">
                    {% for project_purchase_order_form in value.forms %}
                    <div class="carousel-item {% if forloop.counter0 == 0 %} active{% endif %}"
                         data-purchase-order-id="{{ project_purchase_order_form.instance.id }}">
                        <!--Carousel here-->
                        <div class="form-wrapper justify-content-around">
                            <!--table data below-->
                            <div class="table-responsive">
                                <table class="table datatable-responsive-borderless table-dark p-1 rounded">
                                    <thead>
                                    <tr>
                                        <th>
                                            Supplier Name
                                        </th>
                                        <th>
                                            Inquiry No.
                                        </th>
                                        <th>
                                            Purchase No.
                                        </th>
                                        <th>
                                            Supplier Ref.
                                        </th>
                                        <th>
                                            Vessel
                                        </th>
                                        <th>
                                            Maker Name
                                        </th>
                                        <th>
                                            Maker Type
                                        </th>
                                        <th>
                                            Payment
                                        </th>
                                        <th>
                                            Delivery
                                        </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr>
                                        <td>
                                            {{ project_purchase_order_form.instance.inquiry.supplier.name }}
                                        </td>
                                        <td>
                                            {{ project_purchase_order_form.instance.inquiry.no }}
                                        </td>
                                        <td>
                                            {{ project_purchase_order_form.instance.no }}
                                        </td>
                                        <td>
                                            {{ project_purchase_order_form.instance.inquiry.supplier_ref }}
                                        </td>
                                        <td>
                                            {{ project_purchase_order_form.instance.project.request.vessel.name }}
                                        </td>
                                        <td>
                                            {{ project_purchase_order_form.instance.project.request.maker.name }}
                                        </td>
                                        <td>
                                            {{ project_purchase_order_form.instance.project.request.maker_type.type }}
                                        </td>
                                        <td>
                                            {{ project_purchase_order_form.instance.order_confirmation.quotation.get_payment_display }}
                                        </td>
                                        <td>
                                            {{ project_purchase_order_form.instance.order_confirmation.quotation.delivery }}
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!--table data above-->

                            <form method="POST" enctype="multipart/form-data">
                                {% csrf_token %}
                                <div class="row justify-content-center" style="margin-top:20px;">
                                    {% for field in project_purchase_order_form %}
                                    <div class="form-group col-lg-3">
                                        <label>{{field.label}}</label>
                                        {{ field }}
                                        {{ field.errors }}
                                    </div>
                                    {% endfor %}
                                </div>
                                <!-- /Company info -->
                            </form>
                        </div>

                        <!--Purchase order table details below-->
                        <div class="table-responsive">
                            <table class="table table-striped table-hover w-100 table-bordered border no-footer purchaseOrderDataTable">
                                <colgroup>
                                    <col span="1">
                                    <col span="1">
                                    <col span="1" style="width: 1%; white-space: nowrap">
                                    <col span="1" style="width: 1%; white-space: nowrap">
                                    <col span="1" style="width: 1%; white-space: nowrap">
                                    <col span="1" style="width: 1%; white-space: nowrap">
                                    <col span="1">
                                    <col span="1" style="width: 1%; white-space: nowrap">
                                    <col span="1" style="width: 1%; white-space: nowrap">
                                    <col span="1" style="width: 1%; white-space: nowrap">
                                    <col span="1" style="width: 1%; white-space: nowrap">
                                </colgroup>
                                <thead>
                                <tr>
                                    <th>{% trans 'ID' %}</th>
                                    <th>{% trans 'Part No' %}</th>
                                    <th>{% trans 'Part Name' %}</th>
                                    <th>{% trans 'Purchase Order ID' %}</th>
                                    <th>{% trans 'Quantity' %}</th>
                                    <th>{% trans 'Unit' %}</th>
                                    <th>{% trans 'Unit Price' %}</th>
                                    <th>{% trans 'Total Price' %}</th>
                                    <th>{% trans 'Order Type' %}</th>
                                    <th>{% trans 'Availability' %}</th>
                                    <th>{% trans 'Availability Type' %}</th>
                                    <th>{% trans 'Quality' %}</th>
                                    <th>{% trans 'Actions' %}</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                        <!--Purchase order table details above-->
                    </div>
                    {% endfor %}
                </div>
                <fieldset class="card-body border-top w-100 text-center">
                    <a href="{% url 'sales:project_'|add:previous_stage project.id %}"
                       class="btn btn-sm btn-primary previous_stage">
                        {% trans 'Previous' %}
                    </a>
                    <button type="button" class="btn btn-sm btn-success save_stage">{% trans 'Save' %}</button>
                    <button type="button" class="btn btn-sm btn-danger delete_stage">{% trans 'Delete' %}</button>
                    <a href="{% url 'sales:project_'|add:next_stage project.id %}"
                       class="btn btn-sm btn-primary next_stage">
                        {% trans 'Next' %}
                    </a>
                </fieldset>
                <a style="margin-left: -22px; width:30px;" class="carousel-control-prev justify-content-lg-start "
                   href="#{{ quotation_no }}" role="button" data-slide="prev">
                    <span style="position: absolute;top: 30%; height:1.5vw;  width: 1.5vw;" class="carousel-control-prev-icon "
                          aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a style="margin-right: -22px;width:30px; " class="carousel-control-next justify-content-lg-end"
                   href="#{{ quotation_no }}" role="button" data-slide="next">
                    <span style="position: absolute;top: 30%; height:1.5vw;  width: 1.5vw;" class="carousel-control-next-icon"
                          aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
            {% endfor %}
            <!--Carousel Here-->
        </div>
    </div>
    <!-- /inner container -->
    <button class="overViewBTN sidebar-control sidebar-right-toggle sidebar-mobile-right-toggle"><i class="far fa-eye"></i></button>
</div>
{% endblock %}
<!-- Content bloğu sonu -->
{% block javascript %}
<script>
    project_id={{project.id}}
    project_update_api_url = "{% url 'sales:project_update_api' 0 %}"

    quotation_parts_api_url = new URL(window.location.href)
    quotation_parts_api_url.pathname = "{% url 'sales:quotation_parts_api' %}"

    project_purchase_order_excel_url = "{% url 'sales:project_purchase_order_excel' 0 0 %}"
    project_purchase_order_pdf_url = "{% url 'sales:project_purchase_order_pdf' 0 0 %}"

    purchase_order_create_api_url = "{% url 'sales:purchase_order_create_api' %}";
    purchase_order_update_api_url = "{% url 'sales:purchase_order_update_api' 0 %}";
    purchase_order_parts_api_url = "{% url 'sales:purchase_order_parts_api' %}?format=datatables"
    purchase_order_part_create_api_url = "{% url 'sales:purchase_order_part_create_api' %}";
    purchase_order_part_list_create_api_url = "{% url 'sales:purchase_order_part_list_create_api' %}";
    purchase_order_part_update_api_url = "{% url 'sales:purchase_order_part_update_api' 0 %}";

    order_type_choices = {{ order_type_choices|safe }}
</script>
<script src="{% static 'js/sales/project/purchase_order/purchase_order.js' %}"></script>
<script>
    const project_document_create_api_url = "{% url 'sales:project_document_create_api' %}"
    const project_documents_api_url = "{% url 'sales:project_documents_api' %}?project="+project_id
    const project_document_update_api_url = "{% url 'sales:project_document_update_api' 0 %}"
</script>
<script src="{% static 'js/sales/project/right_sidebar/right_sidebar.js' %}"></script>
{% endblock javascript %}