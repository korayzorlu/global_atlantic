{% load static %}

<form action="/purchasing/project_item_add/p_{{projectId}}" method="post" class="modal-content form-container border" id="form-{{elementTag}}-{{elementTagId}}-add-2" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="modal-body">
      <div class="row mb-1 tableBox-inform-{{elementTagSub}}-{{elementTagId}}">
        <table id="table-{{elementTagSub}}-{{elementTagId}}" class="table table-striped table-hover table-bordered dataTable no-footer" style="width:100%">
          <thead>
              <tr>
                  <th></th>
                  <th></th>
                  <th>ID</th>
                  <th>Part Unique</th>
                  <th>Part Unique</th>
                  <th>Maker</th>
                  <th>Type</th>
                  <th>Part No</th>
                  <th>Group</th>
                  <th>Description</th>
                  <th>Tech. Spec.</th>
                  <th>Manufacturer</th>
                  <th>Cross Ref</th>
                  <th>Unit</th>
              </tr>
          </thead>
          <tbody id="tbody">
                  
          </tbody>
        </table>
      </div>
    </div>
    <div class="modal-footer shadow-5-strong" style="padding: 10px;">
        <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-danger" type="submit">Add</button>
    </div>
</form>

<script>
  var detailRefererPathSub = "{{refererPath}}";

  var elementTag = "{{elementTag}}";
  var elementTagSub = "{{elementTagSub}}";
  var elementTagId = "{{elementTagId}}";
  var projectItemId = "{{projectItem.id}}";
  var projectId = "{{projectItem.project.id}}";
  var pageUrl = "/purchasing/project_item_add/r_" + elementTagId + "/";
  var addSubDataHxGet = "/purchasing/project_item_add/p_" + elementTagId + "/";

  $("#form-{{elementTag}}-{{elementTagId}}-add-2").submit(function (event) {

    event.preventDefault();

    var formData = $(this).serializeArray();

    tableProjectItems = $("#table-{{elementTagSub}}-{{elementTagId}}");
    
    for(let i = 0; i < tableProjectItems.DataTable().rows({selected:true}).data().length; i++){
      formData.push({name: "projectItems", value: tableProjectItems.DataTable().rows({selected:true}).data()[i]["id"]});
    };

    //console.log(tableProjectItems.DataTable().rows({selected:true}).data());
    
    $.ajax({
      type: "POST",
      url: "/purchasing/project_item_add/p_{{elementTagId}}/?type=part",  // Formunuzun işleneceği view'ın URL'si
      data: formData,
      success: function (response, status, xhr) {
          // Başarılı yanıt geldiğinde mesajı görüntüleyin
          if (xhr.status === 204) {
            addUpdateDataModalXl.hide();
          }
      },
      error: function (xhr, status, error) {
        //spinner durdurur
        $("body").busyLoad("hide", {
          animation: "fade"
        });
          // Hata durumunda mesajı görüntüleyin
          $("#message-container-{{elementTag}}-{{elementTagId}}-add-2").html('<div id="message-container-inside-{{elementTag}}-{{elementTagId}}-add-2"><i class="fas fa-xmark-circle me-1"></i>At least one part must be selected!</div>');
      }
    });

  });
    
</script>

{% block javascript %}

<script src="{% static 'js/purchasing/project_item/add.js' %}"></script>

{% endblock javascript %}