{% include 'includes/control/htmx_control.html' %}
<form hx-post="{{ request.path }}" class="modal-content form-container border" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="modal-header">
        <h5 class="modal-title">PO List</h5>
    </div>
    <div class="modal-body">
        {% for purchaseOrder in purchaseOrders %}
            <div class="row">
                <div class="col-md-2 mb-3">
                    {{purchaseOrder.purchaseOrderNo}}
                </div>
                <div class="col-md-6 mb-3">
                    {{purchaseOrder.inquiry.supplier.name}}
                </div>
                <div class="col-md-4 mb-3">
                    <button class="btn btn-danger btn-sm ms-auto" hx-get="/account/incoming_invoice_add/type_{{type}}_po_{{purchaseOrder.id}}" hx-target="#addUpdateDataDialog" hx-push-url="true">
                        <i class="fa-solid fa-file-lines fa-xl" data-mdb-toggle="tooltip" data-mdb-placement="right" title="Incoming Invoice"></i>
                        Create Incoming Invoice
                    </button>
                    {% comment %} {% if purchaseOrder.incomingInvoiced == True %}
                        <button class="btn btn-danger btn-sm ms-auto" id="createIncomingInvoiceButton" poid="{{purchaseOrder.id}}" disabled>
                            <i class="fa-solid fa-file-lines fa-xl" data-mdb-toggle="tooltip" data-mdb-placement="right" title="Incoming Invoice"></i>
                            Invoiced
                        </button>
                    {% else %}
                        <button class="btn btn-danger btn-sm ms-auto" hx-get="/account/incoming_invoice_add/po_{{purchaseOrder.id}}" hx-target="#addUpdateDataDialog" hx-push-url="true">
                            <i class="fa-solid fa-file-lines fa-xl" data-mdb-toggle="tooltip" data-mdb-placement="right" title="Incoming Invoice"></i>
                            Create Incoming Invoice
                        </button>
                    {% endif %} {% endcomment %}
                </div>
            </div>
        {% endfor %}
    </div>
</form>

<script>
    var poId = "{{purchaseOrders.0.id}}"
    {% comment %} $("#createIncomingInvoiceButton").click(function(){
        console.log(this.attr("poid"));
        $("body").busyLoad("show", {
            animation: false,
            spinner: "pulsar",
            maxSize: "150px",
            minSize: "150px",
            text: "Loading ...",
            background: "rgba(69, 83, 89, 0.6)",
            color: "#455359",
            textColor: "#fff"
        });
        
        //htmx.ajax("POST", "/account/incoming_invoice_add/po_" + poId + "/" , "#addUpdateDataDialog");
        $("body").busyLoad("hide", {
            animation: "fade"
        });
    }); {% endcomment %}

    {% comment %} function createIncomingInvoice(button){
        $("body").busyLoad("show", {
            animation: false,
            spinner: "pulsar",
            maxSize: "150px",
            minSize: "150px",
            text: "Loading ...",
            background: "rgba(69, 83, 89, 0.6)",
            color: "#455359",
            textColor: "#fff"
        });

        htmx.ajax("POST", "/account/incoming_invoice_add/po_" + $(button).attr("poid") + "/", {target : "#addUpdateDataDialog", "push-url" : "true"});

        $("body").busyLoad("hide", {
            animation: "fade"
        });
    }; {% endcomment %}

</script>