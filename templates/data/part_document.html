
{% load static %}
{% load widget_tweaks %}
<div class="row mb-1">
    <div class="col-md-2">
        <div class="row p-2">
            <div class="col-md-12">
                <div class="file-upload-wrapper">
                    {% comment %} {% render_field imageForm.image data-mdb-height="100" data-mdb-accepted-extensions="image/*" data-mdb-default-msg="" %} {% endcomment %}
                    <input type="file" id="partImageUpload" class="file-upload-input" data-mdb-height="100" data-mdb-accepted-extensions="image/*" data-mdb-default-msg="Add an image" data-mdb-preview-msg="sdf" data-mdb-file-upload="file-upload">
                </div>
            </div>
        </div>
        <div class="row p-2">
            <div class="col-md-12 d-grid">
                <button type="button" id="partImageUploadButton" class="btn btn-sm d-none d-flex justify-content-center text-center bg-blue-gray-900 text-white" style="cursor:pointer;">
                    Upload
                    <i class="fa-solid fa-cloud-arrow-up ms-2"></i>
                </button>
            </div>
        </div>
    </div>

    {% for image in images %}
        <div class="col-md-1">
            <div class="row p-2">
                <div class="col-md-12">
                    <div class="row lightbox">
                        <div class="col-md-12">
                            <img src="{{image.image.url}}" data-mdb-img="{{image.image.url}}" alt="" class="" style="height:100px;width:100%;"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <button type="button" data-image-id="{{image.id}}" class="deleteData tableTopButtons inTableButtons partImageRemoveButton">
                                <i class="fa-regular fa-trash-can fs-6 text-red-300" data-mdb-toggle="tooltip" data-mdb-placement="right" title="Remove this image"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
        
</div>

<script>
    $("#partImageUpload").on("fileAdd.mdb.fileUpload", function(e) {
        console.log(e.files[0]);
        var formData = new FormData();
        formData.append('image', e.files[0]);

        $("#partImageUploadButton").removeClass("d-none");

        $("#partImageUploadButton").off("click").on("click", function(){
            $.ajax({
                type: "POST",
                url: "/data/part_image_add/p_{{part.id}}/",
                contentType: false,
                processData: false,
                data: formData,
                success: function () {
                    document.getElementById("tabPane-{{elementTag}}-{{elementTagId}}-add-1").innerHTML = "";
                    htmx.ajax('GET', "/data/part_document/{{part.id}}", "#tabPane-{{elementTag}}-{{elementTagId}}-add-1");
                }
            });
        });
    });

    $("#partImageUpload").on("fileRemove.mdb.fileUpload", function(e) {
        $("#partImageUploadButton").addClass("d-none");
    });

    $(".partImageRemoveButton").on("click", function(){
        let imageId = $(this).attr("data-image-id");
        $.ajax({
            type: "POST",
            url: "/data/part_image_delete/" + imageId + "/",
            success: function () {
                document.getElementById("tabPane-{{elementTag}}-{{elementTagId}}-add-1").innerHTML = "";
                htmx.ajax('GET', "/data/part_document/{{part.id}}", "#tabPane-{{elementTag}}-{{elementTagId}}-add-1");
            }
        });
    });

</script>