{% load static %}
{% load widget_tweaks %}



<div class="col-md-12">
    <div class="row">
        <div class="col-md-12 d-flex justify-content-center">
          <div class="file-upload-wrapper" style="background-color: #c9c9c9;">
              {% render_field orderTrackingDocumentForm.file data-mdb-height="100" data-mdb-accepted-extensions=".pdf" %}
          </div>
        </div>
    </div>
    <div class="row p-2">
        <div class="col-md-12 d-grid">
            <button type="button" id="orderTrackingDocumentUploadButton" class="btn btn-sm d-none d-flex justify-content-center text-center bg-blue-gray-900 text-white" style="cursor:pointer;">
                Upload
                <i class="fa-solid fa-cloud-arrow-up ms-2"></i>
            </button>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12 overflow-auto" style="max-height:240px;">
            {% for collection in collections %}
            <div class="row p-2">
                <a hx-get="/sale/inquiry_pdf/{{collection.collection.purchaseOrder.inquiry.id}}_s_ot/" hx-target="#tabContSub-{{elementTag}}" hx-swap="afterbegin" hx-push-url="true" style="cursor:pointer;">
                    <i class="fa-solid fa-file-pdf fa-xl"></i>
                    Inquiry Form[{{collection.collection.purchaseOrder.inquiry.inquiryNo}}]
                </a>
            </div>
            {% endfor %}
            <div class="row p-2">
                <a hx-get="/sale/quotation_pdf/{{collections.0.collection.purchaseOrder.orderConfirmation.quotation.id}}_s_ot/" hx-target="#tabContSub-{{elementTag}}" hx-swap="afterbegin" hx-push-url="true" style="cursor:pointer;">
                    <i class="fa-solid fa-file-pdf fa-xl"></i>
                    Quotation Form[{{collections.0.collection.purchaseOrder.orderConfirmation.quotation.quotationNo}}]
                </a>
            </div>
            <div class="row p-2">
                <a hx-get="/sale/order_confirmation_pdf/{{collections.0.collection.purchaseOrder.orderConfirmation.id}}_s_ot/" hx-target="#tabContSub-{{elementTag}}" hx-swap="afterbegin" hx-push-url="true" style="cursor:pointer;">
                    <i class="fa-solid fa-file-pdf fa-xl"></i>
                    Order Confirmation Form[{{collections.0.collection.purchaseOrder.orderConfirmation.orderConfirmationNo}}]
                </a>
            </div>
            {% for collection in collections %}
            <div class="row p-2">
                <a hx-get="/sale/purchase_order_pdf/{{collection.collection.purchaseOrder.id}}_s_ot/" hx-target="#tabContSub-{{elementTag}}" hx-swap="afterbegin" hx-push-url="true" style="cursor:pointer;">
                    <i class="fa-solid fa-file-pdf fa-xl"></i>
                    Purchase Order Form[{{collection.collection.purchaseOrder.purchaseOrderNo}}]
                </a>
            </div>
            {% endfor %}
            {% for commericalInvoice in commericalInvoices %}
            <div class="row p-2">
                <a hx-get="/account/commerical_invoice_pdf_in_ot/{{commericalInvoice.id}}/" hx-target="#tabContSub-{{elementTag}}" hx-swap="afterbegin" hx-push-url="true" style="cursor:pointer;">
                    <i class="fa-solid fa-file-pdf fa-xl"></i>
                    Commerical Invoice Form[{{commericalInvoice.commericalInvoiceNo}}]
                </a>
            </div>
            {% endfor %}
            {% for sendInvoice in sendInvoices %}
            <div class="row p-2">
                <a hx-get="/account/send_invoice_pdf_in_ot/{{sendInvoice.id}}/" hx-target="#tabContSub-{{elementTag}}" hx-swap="afterbegin" hx-push-url="true" style="cursor:pointer;">
                    <i class="fa-solid fa-file-pdf fa-xl"></i>
                    Send Invoice Form[{{sendInvoice.sendInvoiceNo}}]
                </a>
            </div>
            {% endfor %}
            {% for document in documents %}
            <div class="row p-2">
                <div class="col-md-11 text-start">
                    <a hx-get="/sale/order_tracking_document_pdf/{{document.id}}_{{document.name}}" hx-target="#tabContSub-{{elementTag}}" hx-swap="afterbegin" hx-push-url="true" style="cursor:pointer;">
                        <i class="fa-solid fa-file-pdf fa-xl"></i>
                        {{document.name}}
                    </a>
                </div>
                <div class="col-md-1 text-center">
                    <button type="button" data-document-id="{{document.id}}" class="deleteData tableTopButtons inTableButtons p-0 m-0 orderTrackingDocumentRemoveButton" style="height:auto;">
                        <i class="fa-regular fa-trash-can text-red-300" data-mdb-toggle="tooltip" data-mdb-placement="right" title="Remove this image" style="font-size:0.875rem;"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    $("#orderTrackingDocumentUpload").on("fileAdd.mdb.fileUpload", function(e) {

        $("#orderTrackingDocumentUploadButton").removeClass("d-none");

        $("#orderTrackingDocumentUploadButton").off("click").on("click", function(){
            var formData = new FormData();
            formData.append('file', e.files[0]);
            
            $.ajax({
                type: "POST",
                url: "/sale/order_tracking_document_add/ot_{{orderTracking.id}}/",
                contentType: false,
                processData: false,
                data: formData,
                success: function () {
                    document.getElementById("orderTrackingDocumentRow-{{elementTag}}-{{orderTracking.id}}").innerHTML = "";
                    htmx.ajax('GET', "/sale/order_tracking_document/{{orderTracking.id}}", "#orderTrackingDocumentRow-{{elementTag}}-{{orderTracking.id}}");
                }
            });

            {% comment %} htmx.ajax("POST", "/sale/order_tracking_document_add/ot_{{orderTracking.id}}/", {target : "#addUpdateDataDialog-inform", headers : "{'X-CSRFToken': '{{ csrf_token }}'}"});

            

            setTimeout(function(){
                htmx.ajax('GET', "/sale/order_tracking_document/{{orderTracking.id}}", "#orderTrackingDocumentRow-{{elementTag}}-{{orderTracking.id}}");
            },1500); {% endcomment %}

            

            
        });

    });
    
    $("#orderTrackingDocumentUpload").on("fileRemove.mdb.fileUpload", function(e) {
        $("#orderTrackingDocumentUploadButton").addClass("d-none");
    });

    $(".orderTrackingDocumentRemoveButton").on("click", function(){
        let documentId = $(this).attr("data-document-id");
        $.ajax({
            type: "POST",
            url: "/sale/order_tracking_document_delete/" + documentId + "/",
            success: function () {
                document.getElementById("orderTrackingDocumentRow-{{elementTag}}-{{orderTracking.id}}").innerHTML = "";
                htmx.ajax('GET', "/sale/order_tracking_document/{{orderTracking.id}}", "#orderTrackingDocumentRow-{{elementTag}}-{{orderTracking.id}}");
            }
        });
    });

</script>